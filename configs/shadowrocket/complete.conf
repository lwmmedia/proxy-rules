#!name=Shadowrocket Complete Configuration
#!desc=Production-ready config with rule-sets and security features
#!author=lwmmedia
#!date=2025-01-15

[General]
bypass-system = true
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,*.lan
tun-excluded-routes = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32
dns-server = 223.5.5.5,114.114.114.114,system
fallback-dns-server = 1.1.1.1,8.8.8.8
ipv6 = false
prefer-ipv6 = false
update-url = https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/configs/shadowrocket/complete.conf

[Proxy Group]
# Auto selection based on latency
Auto = url-test,url=http://cp.cloudflare.com/generate_204,interval=300,tolerance=50,timeout=5

# Manual selection with all proxies
Select = select

# Streaming services
YouTube = select,Auto,Select,DIRECT
Netflix = select,Auto,Select,DIRECT
Disney+ = select,Auto,Select,DIRECT

# Social platforms
Telegram = select,Auto,Select,DIRECT
Discord = select,Auto,Select,DIRECT
Twitter = select,Auto,Select,DIRECT

# Global services
Google = select,Auto,Select,DIRECT
Apple = select,Auto,Select,DIRECT
Microsoft = select,Auto,Select,DIRECT

# Final routing
Global = select,Auto,Select,DIRECT

[Rule]
# ============================================
# SECURITY & PRIVACY RULES
# ============================================

# Block QUIC to force TCP/TLS
AND,((PROTOCOL,UDP),(DST-PORT,443)),REJECT
AND,((PROTOCOL,UDP),(DST-PORT,80)),REJECT

# Block common malware domains
DOMAIN-KEYWORD,malware,REJECT
DOMAIN-KEYWORD,virus,REJECT
DOMAIN-KEYWORD,trojan,REJECT
DOMAIN-KEYWORD,phishing,REJECT
DOMAIN-KEYWORD,scam,REJECT

# Block ads and tracking
DOMAIN-KEYWORD,analytics,REJECT
DOMAIN-KEYWORD,tracking,REJECT
DOMAIN-KEYWORD,telemetry,REJECT
DOMAIN-KEYWORD,doubleclick,REJECT
DOMAIN-SUFFIX,googleadservices.com,REJECT
DOMAIN-SUFFIX,googlesyndication.com,REJECT
DOMAIN-SUFFIX,googletagmanager.com,REJECT

# ============================================
# STREAMING SERVICES
# ============================================

RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/streaming/youtube.list,YouTube
RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/streaming/netflix.list,Netflix

# YouTube additional
DOMAIN-KEYWORD,youtube,YouTube
DOMAIN-KEYWORD,googlevideo,YouTube

# Netflix additional
DOMAIN-KEYWORD,netflix,Netflix
DOMAIN-KEYWORD,nflx,Netflix

# ============================================
# SOCIAL MEDIA & COMMUNICATION
# ============================================

RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/social/telegram.list,Telegram
RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/social/discord.list,Discord
RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/social/twitter.list,Twitter

# Telegram IP ranges
IP-CIDR,91.108.4.0/22,Telegram,no-resolve
IP-CIDR,91.108.8.0/22,Telegram,no-resolve
IP-CIDR,91.108.12.0/22,Telegram,no-resolve
IP-CIDR,91.108.16.0/22,Telegram,no-resolve
IP-CIDR,91.108.56.0/22,Telegram,no-resolve
IP-CIDR,149.154.160.0/20,Telegram,no-resolve

# ============================================
# GLOBAL TECH SERVICES
# ============================================

RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/global/google.list,Google
RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/global/apple.list,Apple
RULE-SET,https://raw.githubusercontent.com/lwmmedia/proxy-rules/main/rules/global/microsoft.list,Microsoft

# ============================================
# APPLE SERVICES OPTIMIZATION
# ============================================

# Apple system services - direct for better performance
DOMAIN-SUFFIX,push.apple.com,DIRECT
DOMAIN-SUFFIX,lcdn-locator.apple.com,DIRECT
DOMAIN-SUFFIX,lcdn-registration.apple.com,DIRECT
DOMAIN-SUFFIX,iphone-ld.apple.com,DIRECT

# Apple CDN - direct for speed
DOMAIN-SUFFIX,mzstatic.com,DIRECT
DOMAIN-KEYWORD,apple-cdn,DIRECT
DOMAIN-KEYWORD,icloud-cdn,DIRECT

# ============================================
# MICROSOFT SERVICES OPTIMIZATION
# ============================================

# Windows Update - direct
DOMAIN-SUFFIX,windowsupdate.com,DIRECT
DOMAIN-SUFFIX,download.windowsupdate.com,DIRECT
DOMAIN-KEYWORD,windows-update,DIRECT

# Office 365 China - direct
DOMAIN-SUFFIX,microsoft.com.cn,DIRECT
DOMAIN-SUFFIX,office365.cn,DIRECT

# ============================================
# EDUCATIONAL & WORK DOMAINS
# ============================================

# Common educational domains - customize as needed
# DOMAIN-SUFFIX,edu,DIRECT
# DOMAIN-SUFFIX,ac.uk,DIRECT
# DOMAIN-KEYWORD,school,DIRECT
# DOMAIN-KEYWORD,university,DIRECT

# ============================================
# LOCAL & CHINA DIRECT
# ============================================

# Local network
DOMAIN-SUFFIX,local,DIRECT
DOMAIN-SUFFIX,localhost,DIRECT
DOMAIN-SUFFIX,lan,DIRECT
IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
IP-CIDR,127.0.0.0/8,DIRECT,no-resolve

# China mainland
GEOIP,CN,DIRECT

# ============================================
# FINAL RULE
# ============================================

# All other traffic
FINAL,Global

[Host]
localhost = 127.0.0.1

[URL Rewrite]
# Force HTTPS
^http://(www.)?google.com https://www.google.com 302
^http://(www.)?youtube.com https://www.youtube.com 302

# Remove tracking parameters
(.*video.*)(\?|&)spm=.+ $1 302
(.*video.*)(\?|&)from=.+ $1 302

[Script]
# No scripts by default - Shadowrocket scripts are optional

[MITM]
# MITM disabled by default - enable only if needed
enable = false
# ca-passphrase = 
# ca-p12 = 
# hostname =